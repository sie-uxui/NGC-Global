ACC.order = {

	_autoload: [
		"initPageEvents",
	    "backToOrderHistory",
	    "bindMultidProduct",
		"bindContactInfoOpen"
	],

	initPageEvents: function () {
		var $orderPage = $('body.page-order');
		if ($orderPage.length) {
			var $milestoneOverview = $orderPage.find('#order-tracking-overview'),
				$milestoneEntries = $orderPage.find('.account-orderdetail-entries-milestones .item__order-tracking');

			$orderPage.find('.account-orderdetail-milestones').removeClass('hidden');

			if ($milestoneOverview.length) {
				$.ajax({
					url: $milestoneOverview.data("milestonesurl"),
					method: 'GET',
					success: function (resp)
					{
						var minStep = resp.minStep,
							maxStep = resp.maxStep,
							entries = resp.entries,
							milestonesForEntries = resp.milestonesForEntries,
							displayMilestoneDate = !!resp.displayMilestoneDate;
						if (resp.isHeadStatus && (minStep || maxStep)) {
							$milestoneOverview.find('.item-milestone-icon').each(function() {
								var $icon = $(this);
								if ($icon.data('step') <= minStep || 0)  {
									$icon.addClass('active');
								}
								if (($icon.data('step') > minStep || 0) && ($icon.data('step') <= maxStep || 0))  {
									$icon.addClass('incomplete');
								}
							});
						} else {
							$milestoneOverview.closest(".account-orderdetail-milestones").hide();
						}

						if (entries) {
							$milestoneEntries.each(function() {
								var entryNo = $(this).data('entryno'),
									milestonesForEntry = milestonesForEntries[entryNo],
									$wrapperList = $(this).find('.item-milestone-icon--wrapper');
								if (entries[entryNo]) {
									$wrapperList.each(function() {
										var $icon = $(this).find('.item-milestone-icon'),
											$date = $(this).find('.milestone-date'),
											iconStep = $icon.data('step'),
											dateValue = milestonesForEntry && milestonesForEntry[iconStep] ?
												milestonesForEntry[iconStep].actualDateFormatted : undefined;
										if (iconStep <= entries[entryNo].step || 0)  {
											$icon.addClass('active');
											if (displayMilestoneDate && dateValue && dateValue.length) {
												$date.removeClass('hidden').text(dateValue);
											}
										}
									});
									$(this).siblings('.item-milestone--mobile').each(function() {
										if ($(this).data('step') === (entries[entryNo].step || 0)) {
											$(this).removeClass('hidden');
										}
									});
									if (entries[entryNo].orderConfirmationSent) {
										$(document).find(".js-delivery-date-" + entryNo).removeClass("hidden")
									}
								} else {
									$(this).closest(".item__order-tracking").hide();
								}
							});
						}
					},
					complete: function (resp) {
						if (resp && resp.responseJSON && resp.responseJSON.status === 'hidden') {
							$orderPage.find('.account-orderdetail-milestones').addClass('hidden');
							return;
						}
						$milestoneOverview.removeClass("loading");
						$milestoneEntries.removeClass("loading");
					}
				});

			}
		}
	},

	backToOrderHistory: function(){
		$(".orderBackBtn > button").on("click", function(){
			var sUrl = $(this).data("backToOrders");
			window.location = sUrl;
		});
	},

	bindMultidProduct: function ()
	{
		// link to display the multi-d grid in read-only mode
		$(document).on("click",'.js-show-multiD-grid-in-order', function (event){
			ACC.multidgrid.populateAndShowGrid(this, event, true);
			return false;
		});

		// link to display the multi-d grid in read-only mode
		$(document).on("click",'.showMultiDGridInOrderOverlay', function (event){
			ACC.multidgrid.populateAndShowGridOverlay(this, event);
		});

	},

	bindContactInfoOpen: function ()
	{
		$(document).on("click",'.contact-info-cards', function (event){
			if(event.target.tagName.toLowerCase() === "a") {
				return true;
			}
			else {
				return false;
			}
		});
	}
};